@using FamilyBudget.Www.App_Helpers
@using FamilyBudget.Www.Mvc.Helpers
@model FamilyBudget.Www.Models.ExpenditureListModel

@{
    string returnParameters = QueryStringParser.EncodeGridParameters(Model.PageIndex, Model.SortField, Model.SortDirection);
}

<div class="panel panel-default">
    <div class="panel-heading">
        <b class="page-header">Список затрат</b>
        <div class="pull-right">
            @Html.ActionLink("Создать", "Create", new {returnParams = @returnParameters}, new {@class = "btn btn-primary"})
        </div>
    </div>
    <!-- /.panel-heading -->
    <div class="panel-body">
        <div class="table-responsive">
            @{
                if (Model != null)
                {
                    using (Html.BeginForm(null, null, FormMethod.Get))
                    {
                        Html.EnableClientValidation(false);
                        <div class="well">
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">@Html.DisplayNameFor(m => m.Filter.Description)</span>
                                    @Html.TextBoxFor(m => m.Filter.Description, new {@class = "form-control", placeholder = "Описание ..."})
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-addon">@Html.DisplayNameFor(m => m.Filter.AccountId)</span>
                                    @Html.DropDownListFor(model => model.Filter.AccountId, Model.Filter.Accounts, null, new {@class = "form-control"})
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-default">
                                    <i class="fa fa-search">&nbsp;Фильтр</i>
                                </button>
                            </div>
                            <div class="col-md-4">
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        WebGrid grid = WebGridHelpers.CreateWebGridWithJqueryUiStyle(Model.Entities, rowsPerPage: Model.PageSize, canPage: true, canSort: true, defaultSort: "Date");
                        @grid.GetHtmlJqueryUiStyle(mode: WebGridPagerModes.All, showNoDataFound: true,
                            columns: grid.Columns(
                                grid.Column("Date", "Дата", item => item.Date.ToString("D")),
                                grid.Column("ExpenditureCategory.Name", "Категория", item => item.ExpenditureCategory.Name),
                                grid.Column("Summa", "Сумма"),
                                grid.Column("Account.Name", "Счет", item => string.Format("({0}) {1}", item.Account.Currency.Code, item.Account.Name)),
                                grid.Column("Description", "Описание"),
                                grid.Column(style: "webgrid-editColumn", format: item => Html.ActionLink("Редактировать", "Edit", new {id = item.ID, returnParams = @returnParameters})),
                                grid.Column(style: "webgrid-deleteColumn", format: item => Html.ActionLink("Удалить", "Delete", new {id = item.ID, returnParams = @returnParameters})
                                    )
                                ))
                        ;
                    }
                }
            }
        </div>
    </div>
</div>